<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="../js/resources/vendor/AdminLTE-2.3.11/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="quote.css">
	<title>询价回复</title>
</head>
<body>

	<div class="paging clone">
		<div data-role="header" id="header">
			<header>
				<h3>询价回复</h3>
			</header>
			<fieldset class="select">
				<label>商户: </label>
			</fieldset>
		</div>
		<div class="container">
			<div class="needDiv">
				<div class="previous"><button class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-btn-inline ui-icon-carat-l"></button></div>
				<div class="needPart">
					<p>需求编号: <span>ABC1000</span></p>
					<p>需求名称: <span>前挡风镜D</span></p>
					<p>需求数量: <span></span></p>
					<p>车型: <span></span> &nbsp;年款: <span></span></p>
					<!-- <p>价格: <span>99</span></p> -->
				</div>
				<div class="next"><button class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-btn-inline ui-icon-carat-r"></button></div>
			</div>
			<div class="resultContainer">
				<div class="resultDiv">
					<input type="radio" name="parts">
					<div class="resultPart">
						<p>商品编号: ABC1000</p>
						<p>商品名称: 前挡风镜D</p>
						<!-- <p>数量: <input type="number"></p> -->
						<p>数量: 10</p>
						<p>价格: 99</p>
					</div>
				</div>
				<div class="resultDiv">
					<input type="radio" name="parts">
					<div class="resultPart">
						<p>商品编号: ABC1000</p>
						<p>商品名称: 前挡风镜D</p>
						<!-- <p>数量: <input type="number"></p> -->
						<p>数量: 10</p>
						<p>价格: 99</p>
					</div>
				</div>
			</div>
		</div>
		<button class="save">保存</button>
		<button class="show">展示</button>
	</div>

	<script src="../js/lib/jquery-1.11.1.js"></script>
	<script src="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<!-- <script src="data.js"></script> -->
	<script>
		// $(document).ready(function(){

			function getData(callback){
				$.getJSON('../../server/nodeServer/data.json',function(json){
					if(callback && $.isFunction(callback))
						callback(json);
				});
			}
			var totalPrice = 0,
				totalQuantity = 0;
			// var data = dataObj;
			var count = 0;
			getData(function(data){
				// $('.ui-page').remove();
				$.each(data.data,function(k){
					var product = this;
					var clone = $('.clone').clone().removeClass('clone').show();
					clone.prop('id','page'+ k);
					clone.find('.needPart p').eq(0).find('span').html(product.product.code);
					clone.find('.needPart p').eq(1).find('span').html(product.product.name);
					clone.find('.needPart p').eq(2).find('span').html(product.quantity);
					// clone.find('.needPart p').eq(3).find('span').html(product.price);
					var select = $('<select />').prop('name','company').prop('id','company');
					$('<option />').text('请选择').val('-1').appendTo(select);
					$('<option />').text('彩虹科技有限公司').val('1000').appendTo(select);
					clone.find('.select').append(select);
					var resultStr = '';
					$.each(product.originProduct,function(){
						var str = '<div class="resultDiv">'+
						// '<input type="radio" name="'+product.id+'" checked="checked" data="'+this.product.code+'">'+
										'<div class="resultPart">'+
											'<p>商品编号: '+this.product.code+'</p>'+
											'<p>商品名称: '+this.product.name+'</p>'+
											'<p>供应商名称: '+this.supplier.name+'</p>'+
											// '<p><label>数量: </label><input type="number" value="'+ this.quantity +'"></p>'+
											'<p class="price">价格: <input type="number" value="'+this.price+'" ></p>'+
											// '<p class="quantity"><button class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-btn-inline ui-icon-minus"></button> <input type="number" value="'+ this.quantity +'">'+
											// '<button class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-btn-inline ui-icon-plus"></button></p>'+
										'</div></div>';
						// if(product.id.id)
							resultStr += str;
						// else
							// resultStr = '<p class="noProduct">无供应</p>'
					});
					clone.find('.resultContainer').html(resultStr);


					$('body').append(clone);
					$('input[name="'+product.id+'"]').on('change',function(){
						var value = $(this).attr('data');
						var price = $(this).parent().parent('.resultDiv').find('.resultPart .price input').val();
						$.each(product.originProduct,function(){
							if(value == this.product.code)
								console.log(this);
						});
						console.log(price);
						// value = JSON.parse(value);
					});
					totalPrice+= parseInt(this.price);
					totalQuantity+= parseInt(this.quantity);
				});
				count = 0;
				var selectValue = '-1';
				//reload page set count
				// $.each($('.paging'),function(k){
				// 	if($(this).css('display') === 'block')
				// 		count = k;
				// });
				$('.right a').prop('href','#page' + (count));

				//左右滑动切换
				$('.paging').on('swiperight',function(){
					count--;
					if(count < 0){
						count = 0;
						return false;
					}
					location.hash = '#page' + count;
					$('.paging').hide();
					$('#page'+ count).show();
				});
				$('.paging').on('swipeleft',function(){
					count++;
					if(count > data.data.length-1){
						count = data.data.length-1;
						return false;
					}
					location.hash = '#page' + count;
					$('.paging').hide();
					$('#page'+ count).show();
				});
				$('.previous').unbind().on('click',function(){
					selectValue = $('#page'+ count).find('select').val();
					count--;
					if(count < 0){
						count = 0;
						return false;
					}
					// setPublic(count,selectValue);
					location.hash = '#page' + count;
					$('.paging').fadeOut();
					$('#page'+ count).fadeIn();
					$('#page'+ count).find('select').val(selectValue).change();
				});
				$('.next').unbind().on('click',function(){
					selectValue = $('#page'+ count).find('select').val();
					count++;
					if(count > data.data.length-1){
						count = data.data.length-1;
						return false;
					}
					// setPublic(count,selectValue);
					location.hash = '#page' + count;
					$('.paging').fadeOut();
					$('#page'+ count).fadeIn();
					$('#page'+ count).find('select').val(selectValue).change();
				});

				//点击div选择配件
				$('.resultPart').unbind().on('click',function(){
					$(this).prev('div').find('input').trigger('click');
				});

				setTimeout(function(){
					var hash = location.hash.match(/\d+/);
					location.hash = '';
					if(hash)
						count = hash[0];
					$.mobile.changePage('#page' + count);
					$('.paging').hide();
					$('#page'+ count).show();
					// setPublic(count,selectValue);
				},500);

				$('.show').unbind().on('click',function(){
					var customerId = $("#company").val();
					var params = {};
					params['customer.id'] = customerId;

					console.log(params);
					location.href = 'pageInfo.html';
				});

				$('.ui-icon-plus').unbind().on('click',function(){
					var value = $(this).prev().find('input').val();
					var num = value;
					num++;
					$(this).prev().find('input').val(num);
				});
				$('.ui-icon-minus').unbind().on('click',function(){
					var value = $(this).next().find('input').val();
					var num = value;
					num--;
					if(num < 0)
						num = 0;
					$(this).next().find('input').val(num);
				});
			});
			function setPublic(count,selectValue){
				selectValue = selectValue || '-1';
				var headerIframe = $('.paging').eq(count).find('#header');
				var merchant = $('<p />').addClass('col-xs-6').html('商户: <select><option value="-1">请选择</option><option value="1000">彩虹科技有限公司</option></select>');
				merchant.find('select').val(selectValue).change();
				var p1 = $('<p />').text('总价:' + totalPrice).addClass('col-xs-6');
				var p2 = $('<p />').text('总数量:' + totalQuantity).addClass('col-xs-6');
				var div = $('<div >').append(merchant).append(p1).append(p2);
				headerIframe.find('h2').html(div);
			}
		// });
	</script>
</body>
</html>
