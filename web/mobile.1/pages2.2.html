<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="../js/resources/vendor/AdminLTE-2.3.11/bootstrap/css/bootstrap.min.css">
	<title>Document</title>
	<style>
		 *{
			touch-action: none;
		 }
		header{
			background: #3c8dbc;
			color: white;
			padding: 5px 15px;
			border-radius: 5px 5px 0 0;
		}
		header span{
			display: block;
			position: absolute;
			right: 10px;
			top: 18px;
			max-width: 230px;
			text-overflow: ellipsis;
			white-space: nowrap;
			overflow: hidden;
			cursor: pointer;
		}
		header h3{
			margin: 10px 5px;
		}
		/* body{
			margin: 0;
		} */
		#header h2{
			font-size: 14px ;
			font-weight: normal;
			margin: 0 ;
			background-color: #fff ;
			line-height: 30px;
			text-align: left ;
		}
		select{
			height: 2.5rem;
			outline: none;
		}
		.text-nowrap{
			overflow: hidden;
			white-space: nowrap;
		}
		.content {
			width: 90%;
			border: 1px solid #ccc;
			margin: 2vh auto;
			height: 30vh;
			padding: 10px;
		}
		.needPart{
			border: 1px solid #ccc;
			margin: 2rem 5rem;
			padding: 1rem;
		}
		.resultContainer{
			border-top: 1px solid #ccc;
		}
		.resultPart{
			border: 1px solid #ccc;
			margin: 2rem 5rem 2rem 8rem;
			padding: 1rem;
		}
		.resultDiv{
			position: relative;
		}
		.ui-radio,.resultDiv input{
			position: absolute;
			top: 36%;
			left: 8%;
		}
		.needDiv{
			position: relative;
		}
		.previous, .next{
			position: absolute;
			width: 4rem;
			top: 37%;
		}
		.previous{
			left: 3%;
		}
		.next{
			right: 1%;
		}
		.clone{
			display: none !important;
		}
	</style>
</head>
<body>

	<div data-role="page" class="paging clone">
		<div data-role="header" id="header">
			<header>
				<h3>微重力</h3>
				<span>商户:中华科技有限公司(M1001)</span>
			</header>
			<h2></h2>
		</div>
		<div class="container">
			<div class="needDiv">
				<div class="previous">pre</div>
				<div class="needPart">
					<p>需求编号: <span>ABC1000</span></p>
					<p>商品名称: <span>前挡风镜D</span></p>
					<p>数量: <span>10</span></p>
					<p>价格: <span>99</span></p>
				</div>
				<div class="next">next</div>
			</div>
			<div class="resultContainer">
				<div class="resultDiv">
					<input type="radio" name="parts">
					<div class="resultPart">
						<p>商品编号: ABC1000</p>
						<p>商品名称: 前挡风镜D</p>
						<p>数量: 10</p>
						<p>价格: 99</p>
					</div>
				</div>
				<div class="resultDiv">
					<input type="radio" name="parts">
					<div class="resultPart">
						<p>商品编号: ABC1000</p>
						<p>商品名称: 前挡风镜D</p>
						<p>数量: 10</p>
						<p>价格: 99</p>
					</div>
				</div>
			</div>
		</div>
		<button>展示</button>
	</div>

	<script src="../js/lib/jquery-1.11.1.js"></script>
	<script src="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<!-- <script src="data.js"></script> -->
	<script>
		// $(document).ready(function(){

			function getData(callback){
				$.getJSON('../../server/nodeServer/data.json',function(json){
					if(callback && $.isFunction(callback))
						callback(json);
				});
			}
			var totalPrice = 0,
				totalQuantity = 0;
			// var data = dataObj;
			var count = 0;
			getData(function(data){
				$.each(data.data,function(k){
					var product = this;
					var clone = $('.clone').clone().removeClass('clone').show();
					clone.prop('id','page'+ k);
					clone.find('.needPart p').eq(0).find('span').html(product.product.code);
					clone.find('.needPart p').eq(1).find('span').html(product.product.name);
					clone.find('.needPart p').eq(2).find('span').html(product.quantity);
					clone.find('.needPart p').eq(3).find('span').html(product.price);
					var resultStr = '';
					$.each(product.originProduct,function(){
						var str = '<div class="resultDiv"><input type="radio" name="parts">'+
										'<div class="resultPart">'+
											'<p>商品编号: '+this.product.code+'</p>'+
											'<p>商品名称: '+this.product.name+'</p>'+
											'<p>数量: '+this.quantity+'</p>'+
											'<p>价格: '+this.price+'</p>'+
										'</div></div>';
						resultStr += str;
					});
					clone.find('.resultContainer').html(resultStr);


					$('body').append(clone);
					totalPrice+= parseInt(this.price);
					totalQuantity+= parseInt(this.quantity);
				});
				count = 0;
				var selectValue = '-1';
				//reload page set count
				$.each($('.paging'),function(k){
					if($(this).css('display') === 'block')
						count = k;
				});
				$('.right a').prop('href','#page' + (count));

				//左右滑动切换
				// $('.paging').on('swiperight',function(){
				// 	count--;
				// 	if(count < 0){
				// 		count = 0;
				// 		return false;
				// 	}
				// 	location.hash = '#page' + count;
				// });
				// $('.paging').on('swipeleft',function(){
				// 	count++;
				// 	if(count > data.data.length-1){
				// 		count = data.data.length-1;
				// 		return false;
				// 	}
				// 	location.hash = '#page' + count;
				// });
				$('.previous').on('tap',function(){
					count--;
					if(count < 0){
						count = 0;
						return false;
					}
					setPublic(count,selectValue);
					location.hash = '#page' + count;
					$('.ui-page').hide();
					$('#page'+ count).show();
				});
				$('.next').on('tap',function(){
					count++;
					if(count > data.data.length-1){
						count = data.data.length-1;
						return false;
					}
					setPublic(count,selectValue);
					location.hash = '#page' + count;
					$('.ui-page').hide();
					$('#page'+ count).show();
				});
				setTimeout(function(){
					var hash = location.hash.match(/\d+/);
					location.hash = '';
					if(hash)
						count = hash[0];
					$.mobile.changePage('#page' + count);
					$('.ui-page').hide();
					$('#page'+ count).show();
					setPublic(count,selectValue);
				},500);
			});
			function setPublic(count,selectValue){
				selectValue = selectValue || '-1';
				var headerIframe = $('.paging').eq(count).find('#header');
				var merchant = $('<p />').addClass('col-xs-6').html('商户: <select><option value="-1">请选择</option><option value="1000">彩虹科技有限公司</option></select>');
				merchant.find('select').val(selectValue).change();
				var p1 = $('<p />').text('总价:' + totalPrice).addClass('col-xs-6');
				var p2 = $('<p />').text('总数量:' + totalQuantity).addClass('col-xs-6');
				var div = $('<div >').append(merchant).append(p1).append(p2);
				headerIframe.find('h2').html(div);
			}
		// });
	</script>
</body>
</html>
