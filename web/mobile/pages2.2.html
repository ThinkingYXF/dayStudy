<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="../js/resources/vendor/AdminLTE-2.3.11/bootstrap/css/bootstrap.min.css">
	<title>Document</title>
	<style>
		 *{
			touch-action: none;
		 }
		header{
			background: #3c8dbc;
			color: white;
			padding: 5px 15px;
			border-radius: 5px 5px 0 0;
		}
		header span{
			display: block;
			position: absolute;
			right: 10px;
			top: 18px;
			max-width: 230px;
			text-overflow: ellipsis;
			white-space: nowrap;
			overflow: hidden;
			cursor: pointer;
		}
		header h3{
			margin: 10px 5px;
		}
		/* body{
			margin: 0;
		} */
		#header h2{
			font-size: 14px ;
			font-weight: normal;
			margin: 0 ;
			background-color: #fff ;
			line-height: 30px;
			text-align: left ;
		}
		select{
			height: 2.5rem;
			outline: none;
		}
		iframe{
			border: none;
			border-bottom: 1px solid #ccc;
			width: 100%;
		}
		.ui-footer{
			position: absolute;
			bottom: 15vh;
			width: 100%;
		}
		.ui-footer > button{
			width: 49% !important;
		}
		.ui-field-contain > div{
			text-align: center;
		}
		button{
			position: absolute !important;
			bottom: 5vh !important;
		}
		#filter-menu{
			max-height: 100px;
		}
		.text-nowrap{
			overflow: hidden;
			white-space: nowrap;
		}
		.content {
			width: 90%;
			border: 1px solid #ccc;
			margin: 2vh auto;
			height: 40vh;
			padding: 10px;
		}
	</style>
</head>
<body>
	<!-- <div data-role="page" id="page0" class="paging">
		<iframe id="header" src="../mobile/header.html"></iframe>
		<h1>第一页</h1>
		<div data-role="footer">
			<div class="ui-field-contain">
				<select name="select-native" id="filter-menu0" class="filterable-select" data-native-menu="false">
					<option value="0">第一页</option>
				</select>
			</div>
		</div>
		<button>提交</button>
	</div> -->
	<script src="../js/lib/jquery-1.11.1.js"></script>
	<script src="../js/resources/jquery-mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<!-- <script src="data.js"></script> -->
	<script>
		// $(document).ready(function(){

			function getData(callback){
				$.getJSON('../../server/nodeServer/data.json',function(json){
					if(callback && $.isFunction(callback))
						callback(json);
				});
			}
			var totalPrice = 0,
				totalQuantity = 0;
			// var data = dataObj;
			getData(function(data){
				$('.ui-page').hide();
				$.each(data.data,function(k){
					var product = this;
					var div = $('<div />').attr('data-role','page').addClass('paging').prop('id','page'+k);
					//header
					var header = '<div data-role="header" id="header">'+
									'<header>'+
										'<h3>微重力</h3>'+
										'<span>商户:中华科技有限公司(M1001)</span>'+
									'</header>'+
									'<h2></h2>'+
								'</div>'
					//content
					var content = $('<div />').addClass('content');
					var p1 = $('<p />').text('商品编号: ' + this.product.code).appendTo(content);
					var p2 = $('<p />').text('商品名称: ' + this.product.name).appendTo(content);
					var p3 = $('<p />').text('数量: ' + this.quantity).appendTo(content);
					var p4 = $('<p />').text('价格: ' + this.price).appendTo(content);
					//footer
					var footer = $('<div />').attr('data-role','footer');
					var selectDiv = $('<div />').addClass('ui-field-contain');
					var select = $('<select />').prop('id','filter-menu'+k).addClass('filterable-sleect').attr('data-native-menu',false);
					var button = $('<button />').text('提交');
					var number = 0;
					$.each(data.data,function(j){
						var option = $('<option />').val(number).text(this.product.code);
						number++;
						if(j == k)
							option.prop('selected',true);
						option.appendTo(select);
					});
					selectDiv.append(select).appendTo(footer);
					div.append(header).append(content).append(footer).append(button);
					$('body').append(div);
					var arr = [];
					arr.push(data.data[k]);


					totalPrice+= parseInt(this.price);
					totalQuantity+= parseInt(this.quantity);
				});
			// (function(){
				var count = 0;
				var selectValue = '-1';
				//reload page set count
				$.each($('.paging'),function(k){
					if($(this).css('display') === 'block')
						count = k;
				});
				$('.right a').prop('href','#page' + (count));

				//左右滑动切换
				$('.paging').on('swiperight',function(){
					count--;
					if(count < 0){
						count = 0;
						return false;
					}
					// $.mobile.changePage('#page' + count,{transition: 'fade'});
					location.hash = '#page' + count;
				});
				$('.paging').on('swipeleft',function(){
					count++;
					if(count > data.data.length-1){
						count = data.data.length-1;
						return false;
					}
					// $.mobile.changePage('#page' + count,{transition: 'fade'});
					location.hash = '#page' + count;
				});


				function selectChange(){
					$('.ui-popup-container ul li').off().click(function(){
						var value = $(this).attr('data-option-index');
						$.mobile.changePage('#page' + value);
						// location.hash = '#page' + value;
						count = parseInt(value);
					});
				}

				$('.paging').on('pageshow',function(){
					selectChange();
					setPublic(count,selectValue);
				});
				$('.paging').on('pagebeforeshow',function(){
					$('#filter-menu' + count).val(count).change();
					var headerIframe = $('.paging').eq(count).find('#header');
					selectValue = headerIframe.find('select').val();
				});
				setTimeout(function(){
					var hash = location.hash.match(/\d+/);
					location.hash = '';
					if(hash)
						count = hash[0];
					$.mobile.changePage('#page' + count);
					selectChange();
					setPublic(count,selectValue);
				},500);
			});
			// })();
			function setPublic(count,selectValue){
				selectValue = selectValue || '-1';
				var headerIframe = $('.paging').eq(count).find('#header');
				var merchant = $('<p />').addClass('col-xs-6').html('商户: <select><option value="-1">请选择</option><option value="1000">彩虹科技有限公司</option></select>');
				merchant.find('select').val(selectValue).change();
				var p1 = $('<p />').text('总价:' + totalPrice).addClass('col-xs-6');
				var p2 = $('<p />').text('总数量:' + totalQuantity).addClass('col-xs-6');
				var div = $('<div >').append(merchant).append(p1).append(p2);
				headerIframe.find('h2').html(div);
			}
		// });
	</script>
</body>
</html>
